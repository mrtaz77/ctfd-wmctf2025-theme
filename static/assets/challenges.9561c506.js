import{m as module_default,C as CTFd,h as highlight,T as Tab,d as dayjs,M as Modal,a as Tooltip}from"./index.39750a12.js";function addTargetBlank(e){let a=new DOMParser().parseFromString(e,"text/html");return a.querySelectorAll('a[href*="://"]').forEach(s=>{s.setAttribute("target","_blank")}),a.documentElement.outerHTML}window.Alpine=module_default;module_default.store("challenge",{data:{view:""}});module_default.data("Hint",()=>({id:null,html:null,async showHint(e){if(e.target.open){let t=await CTFd.pages.challenge.loadHint(this.id);if(t.errors){e.target.open=!1,CTFd._functions.challenge.displayUnlockError(t);return}let a=t.data;if(a.content)this.html=addTargetBlank(a.html);else if(await CTFd.pages.challenge.displayUnlock(this.id)){let s=await CTFd.pages.challenge.loadUnlock(this.id);if(s.success){let n=(await CTFd.pages.challenge.loadHint(this.id)).data;this.html=addTargetBlank(n.html)}else e.target.open=!1,CTFd._functions.challenge.displayUnlockError(s)}else e.target.open=!1}}}));module_default.data("Challenge",()=>({id:null,next_id:null,submission:"",tab:null,solves:[],submissions:[],solution:null,response:null,share_url:null,max_attempts:0,attempts:0,ratingValue:0,selectedRating:0,ratingReview:"",ratingSubmitted:!1,async init(){highlight(),this.$watch("$store.challenge.data.view",e=>{e&&module_default.nextTick(()=>{this.executeInlineScripts()})})},executeInlineScripts(){const modal=document.querySelector("#challenge-window");if(modal){const scripts=modal.querySelectorAll("script");scripts.forEach(script=>{if(script.innerHTML)try{eval(script.innerHTML)}catch(e){console.log("Error executing inline script:",e)}});const imgs=modal.querySelectorAll("img[onerror]");imgs.forEach(e=>{e.onerror&&e.onerror()})}},getCleanChallengeName(e){return e?e.replace(/^\[(EASY|MEDIUM|HARD)\]\s*/i,"").trim():""},getStyles(){let e={"modal-dialog":!0};try{switch(CTFd.config.themeSettings.challenge_window_size){case"sm":e["modal-sm"]=!0;break;case"lg":e["modal-lg"]=!0;break;case"xl":e["modal-xl"]=!0;break;default:break}}catch(t){console.log("Error processing challenge_window_size"),console.log(t)}return e},async showChallenge(){new Tab(this.$el).show()},async showSolves(){this.solves=await CTFd.pages.challenge.loadSolves(this.id),this.solves.forEach(e=>(e.date=dayjs(e.date).format("MMMM Do, h:mm:ss A"),e)),new Tab(this.$el).show()},async showSubmissions(){let e=await CTFd.pages.users.userSubmissions("me",this.id);this.submissions=e.data,this.submissions.forEach(t=>(t.date=dayjs(t.date).format("MMMM Do, h:mm:ss A"),t)),new Tab(this.$el).show()},getSolutionId(){return module_default.store("challenge").data.solution_id},async showSolution(){let e=this.getSolutionId();CTFd._functions.challenge.displaySolution=t=>{this.solution=t.html,new Tab(this.$el).show()},await CTFd.pages.challenge.displaySolution(e)},getNextId(){return module_default.store("challenge").data.next_id},async nextChallenge(){let e=Modal.getOrCreateInstance("[x-ref='challengeWindow']");e._element.addEventListener("hidden.bs.modal",t=>{module_default.nextTick(()=>{this.$dispatch("load-challenge",this.getNextId())})},{once:!0}),e.hide()},async getShareUrl(){let e={type:"solve",challenge_id:this.id};const l=(await(await CTFd.fetch("/api/v1/shares",{method:"POST",body:JSON.stringify(e)})).json()).data.url;this.share_url=l},copyShareUrl(){navigator.clipboard.writeText(this.share_url);let e=Tooltip.getOrCreateInstance(this.$el);e.enable(),e.show(),setTimeout(()=>{e.hide(),e.disable()},2e3)},async submitChallenge(){this.response=await CTFd.pages.challenge.submitChallenge(this.id,this.submission),await this.renderSubmissionResponse()},async renderSubmissionResponse(){this.response.data.status==="correct"&&(this.submission=""),this.max_attempts>0&&this.response.data.status!="already_solved"&&this.response.data.status!="ratelimited"&&(this.attempts+=1),this.$dispatch("load-challenges")},async submitRating(){(await CTFd.pages.challenge.submitRating(this.id,this.selectedRating,this.ratingReview)).value?(this.ratingValue=this.selectedRating,this.ratingSubmitted=!0):alert("Error submitting rating")}}));module_default.data("ChallengeBoard",()=>({loaded:!1,challenges:[],challenge:null,async init(){if(this.challenges=await CTFd.pages.challenges.getChallenges(),this.loaded=!0,window.location.hash){let e=decodeURIComponent(window.location.hash.substring(1)),t=e.lastIndexOf("-");if(t>=0){let l=[e.slice(0,t),e.slice(t+1)][1];await this.loadChallenge(l)}}},getCategories(){const e=[];this.challenges.forEach(t=>{const{category:a}=t;e.includes(a)||e.push(a)});try{const t=CTFd.config.themeSettings.challenge_category_order;if(t){const a=new Function(`return (${t})`);e.sort(a())}}catch(t){console.log("Error running challenge_category_order function"),console.log(t)}return e},getChallenges(e){let t=this.challenges;e!==null&&(t=this.challenges.filter(a=>a.category===e));try{const a=CTFd.config.themeSettings.challenge_order;if(a){const l=new Function(`return (${a})`);t.sort(l())}}catch(a){console.log("Error running challenge_order function"),console.log(a)}return t},async loadChallenges(){this.challenges=await CTFd.pages.challenges.getChallenges()},async loadChallenge(e){await CTFd.pages.challenge.displayChallenge(e,t=>{t.data.view=addTargetBlank(t.data.view),module_default.store("challenge").data=t.data,module_default.nextTick(()=>{let a=Modal.getOrCreateInstance("[x-ref='challengeWindow']");a._element.addEventListener("shown.bs.modal",()=>{setTimeout(()=>{const l=module_default.$data(document.querySelector('[x-data="Challenge"]'));l&&l.executeInlineScripts&&l.executeInlineScripts()},100)},{once:!0}),a._element.addEventListener("hidden.bs.modal",l=>{history.replaceState(null,null," ")},{once:!0}),a.show(),history.replaceState(null,null,`#${t.data.name}-${e}`)})})}}));module_default.start();
